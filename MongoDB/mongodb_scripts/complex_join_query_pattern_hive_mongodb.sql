--------------------------------------Pattern 1 ----------------------------------------------------------------------------------
-- Cross-reference the cardholders that used Retailer X ATMs in 2013 and where all of their transactions occurred.

select /*+ STREAMTABLE(a) */ b.program, count(*) 
from atmtxn a 
JOIN terminaldetails b 
ON (a.atminternalid = b.atminternalid) 
where a.TxnTypeID=1 
and a.Settlementdate >='2013-01-01 00:00:00.0' 
and a.Settlementdate <= '2013-12-31 24:00:00.0' 
and a.hpcatm in
(
               select /*+ STREAMTABLE(c) */ c.hpcatm
               from atmtxn c 
    INNER JOIN terminaldetails d ON (c.atminternalid = d.atminternalid) 
               where d.program = 'TARGET' 
    and c.Settlementdate >='2013-01-01 00:00:00.0' 
    and c.Settlementdate <= '2013-12-31 24:00:00.0'    
    and length(hpcatm) > 20
)
group by b.program


--------------------------------------Pattern 2----------------------------------------------------------------------------------

select /*+ STREAMTABLE(a) */ count(*)
from atmtxn a
inner join locationdetails b
on (a.atminternalid=b.atminternalid)
	where a.TxnTypeID = 1
	and a.Surcharge > 0
	and a.Settlementdate >='2013-01-01 00:00:00.0'
	and a.Settlementdate <= '2013-12-31 24:00:00.0'
	and a.bankid in (400041,404048,405011,405012,408109,409758,410177,410181,412065,414314,414526,422394,42298956,422997,425914,426521,435576,435760,436678,440354,441214,441314,449920,450466,450467,450468,450469,450470,455504,455509,455510,455540,456527,462050,463100,463158,463400,463404,463829,469445,472201,475590,475598,476734,479162,479918,479919,484111,486511,486704,490922,490925,491668,491870,493162,503006,515048,543990,543993,544053,545656,547095,547156,547313,551048,551640,557187,558173,566658,566793,567426,568602,574439,575083,575285,57729200,577446,585386,587117,587264,588174,588175,58838606)
	and length(a.hpcatm) > 20
group by b.locationstate

--------------------------------------Pattern 3----------------------------------------------------------------------------------


with q1 as 
	(select /*+ STREAMTABLE(a) */ a.hpcatm, count(*) as sw_wds
    	from atmtxn a 
    		INNER JOIN terminaldetails b ON (a.atminternalid = b.atminternalid) 
    	where b.program = 'SPEEDWAY' 
    		and a.Settlementdate >='2013-01-01 00:00:00.0'
   		 	and a.Settlementdate <= '2013-01-31 24:00:00.0'
   		 	and length(a.hpcatm) > 20
     		and a.txntypeID = 1
     	group by a.hpcatm)
,

q2 as
	(select /*+ STREAMTABLE(b) */ a.hpcatm, count(*) as tot_wds
    	from q1 a
     		inner join atmtxn c 
    			ON (a.hpcatm = c.hpcatm) 
    	where c.Settlementdate >='2013-01-01 00:00:00.0'
   		 	and c.Settlementdate <= '2013-01-31 24:00:00.0'
   		 	and length(c.hpcatm) > 20
     		and c.txntypeid = 1
    	group by a.hpcatm)

select q1.hpcatm, q1.sw_wds, q2.tot_wds
from q1
	inner join q2
		on q1.hpcatm = q2.hpcatm

		
--------------------------------------Pattern 4----------------------------------------------------------------------------------
		
select count(distinct(hpcatm))
from atmtxn a
join locationdetails b
 on (a.atminternalid=b.atminternalid)
where a.TxnTypeID=1
and a.Surcharge=0
and b.allpoint=1
and a.Settlementdate >='2013-01-01 00:00:00.0' and a.Settlementdate <= '2013-12-31 24:00:00.0'
and a.bankid in (374355,374356,374357,400180,400351,400366,400373,400374,400379,400380,400564,400809,400824,40115602,40115603,40115605,401169,40117402,40117403,40117405,401194,401657,401743,401842,401859,401905,401906,401907,402079,402491,402849,402943,402959,403128,403165,403198,403199,403306,403307,40353713,403558,403590,40362313,404207,404225,404644,405003,405073,405074,405075,405299,405395,405609,405983,406063,406066,406496,406643,407159,407239,407943,407944,408058,408096,408097,408120,408530,408599,408808,409244,409245,409289,409322,409365,409995,410671,410825,410836,410890,41107913,411145,411329,411503,411876,412039,412089,412095,412096,412146,412185,412245,412271,412273,412291,412619,412696,412900,413072,413138,413469,413570,413711,413728,413765,413781,413817,413826,413913,413951,414016,414148,414183,414188,414193,41420001,414233,414476,414523,414607,414954,414997,41510800,41510801,415112,415289,415454,415593,41574610,41574709,41574785,41581899,415819,415877,416444,416783,416787,417206,417694,417695,417786,417911,418000,418001,418156,418178,418301,418520,418637,419044,419062,419096,419097,419302,419303,419423,419459,419480,419489,420026,420071,420741,420756,421015,421031,421032,421710,421770,422317,42238450,422394,422496007,422496008,422852,423242,423251,424161,424162,424163,424164,424765,424792,424797,425038,425324,426409,426537,426542,426631,426723,426758,426790,426956,426983,427025,427081,427082,427184,427541,428040,428041,428937,429211,429218,429238,429246,429255,429847,429891,430014,430574,430711,430718,430729,43074300,43074309,43074326,43074328,43074334,43074809,43074814,43074823,43074838,43074839,43074845,430750,430752,430757,430844,430845,430846,430932,431177,431451,431452,431592,431646,431650,431651,432548,432642,432666,432726,43273264,43273320,43273351,43273352,43273360,43273368,43273382,43273385,43273478,43273496,433064,433445,433576,433579,433607,43369701,434171,434172,434233,434272,434829,434841,434843,434880,434895,434896,435137,435175,435221,435512,435516,435520,435554,435662,435670,435817,435856,435895,435896,436649,436653,436658,436875,436876,438473,438480,438701,438842,439205,439212,439858,439977,440105,440107,440155,440156,440228,440332,440354,440359,440409,440481,440836,441225,441613,441809,441947,442036,442251,442347,442520,442590,442637,442639,442640,442656,443088,44326313,443332,443532,443590,443597,44369901,44369902,443904,444051,44439401,444789,445173,445185,445187,445302,445603,446001,44610631,44610686,44610692,44610762,446486,446490,446595,446834,446839,446855,44700381,447028,447077,44708318,44708356,44708366,44708367,44708369,44708371,44708374,447283,447427,447435,447482,447483,447629,447684,447864,447978,448041,448053,448093,448287,448757,448987,449047,449049,449060,449061,449095,449111,449765,449795,450259,450298,450466,450467,450468,450469,450470,450689,450690,450695,45167902,451802,452559,452566,452571,453263,453533,453590,453713,454591,454597,454909,455418,45559213,455940,456908,458144,458413,459104,46000721,46000726,46001029,46001123,46001174,460122,460131,460143,460146,460148,460353,460355,460362,460377,460601,460609,460666,460831,461195,46205813,462100,462159,462161,462530,462803,463105,463442,463454,46359102,464042,464181,464332,464341,464343,464467,464860,464864,464865,465307,465365,465390,465978,46613104,46613133,46613161,466205,466207,4668014,467068,467271,467273,467284,467340,467387,467397,467586,467644,468243,468254,468255,468409,468423,468491,468929,469012,469013,469045,469206,469465,470420,470721,470738,470783,471304,471308,471780,471802,471813,471868,472005,472013,472134,472360,47236999,472766,472773,472796,472966,472970,472973,472980,472988,473028,473040,473054,47309915,47309926,473192,473278,47331002,47331010,473368,473813,473814,474103,474207,474257,474381,474387,474388,474456,474592,474662,474787,474788,474789,475000,475077,475471,475566,475569,475570,475709,476414,476454,476513,476514,476521,476587,476785,477321,477323,477341,477401,477413,477414,477418,477423,477424,477426,477430,477431,477440,477443,477446,477485,477798,477857,477884,478318,478367,478657,478804,478931,478961,479105,479869,4802454,480279,481195,481569,481751,482153,482160,482892,482893,483408,484007,484014,484026,484128,484220,484238,485082,485218,485291,485567,485589,485593,486016,486017,486133,486162,486194,486741,486745,486814,486857,486912,486995,486999,4872053,4872054,487218,487219,487311,487342,487391,488803,488813,488844,489265,489295,489556,489618,489656,489695,490085,490626,490640,490893,490949,491334,491342,49145202,49145305,49145306,491456,491476,491567,491585,491765,491766,491890,491966,492165,492302,493026,493031,493038,493039,493045,493057,493121,493445,493786,499951,499976,500003,500018,500030,500079,500222,500400,500530,500592,500622,501382,50157800,50160300,501779,502325,502341,502379,502417,502520,502554,502776,503103,503120,503528,50392402,504133,504351,504421,504467,504630,504673,504831,504847,504859,504963,506046,506082,510302,510329,510331,510337,510351,510371,510383,510384,510399,510585,510627,510639,510642,510656,510686,510687,510691,510696,510724,510742,510745,510748,510768,510805,510816,510853,510857,510861,510863,510943,510975,510982,511011,511057,511063,511084,511107,511219,511237,511249,511267,511320,511369,511806,511823,511923,51192699,511994,512653,512699,514138,514144,514151,514162,514173,514179,514181,514207,514212,514267,514268,514298,514306,514378,514411,514437,514461,514480,514494,514510,514514,514582,514583,514591,514630,514650,514674,514678,514692,514697,514704,514717,514727,514751,514753,514799,515005100,515005200,515005201,515005203,515005204,515005205,515005206,515005991,515005997,515007,515184,515195,515217,515279,515297,515306,515314,515317,515332,515356,51537146,515376,515385,515404,515409,515417,515431,515436,515440,515468,515472,515534,515565,515567,515571,515921,515925,515948,515992,516174,516259,516607,516701,516720,517063,517556,518906,519040,519046,519052,519054,519062,519087,519099,519102,519385,519386,519401,519402,519404,519405,519406,519407,519408,519421,519453300,519453301,519453302,519453600,519453601,519453602,519453603,519455,519462,519470,519666,519675,519686,519821,519833,519837,519841,519845,519849,519853,520050,520512,520536,520537,520542,520552501,520578,520583,520819,520827,521105,521445,521732,521737,521748,522565,522908,522914,522918,522922,522926,522930,522934,523713,52382863,523866,523867,523870,523875,523877,523907,524546,524557,524583,524904,526235,526281,527184,527212,527822,527831,527833,527838,527839,527841,527842,527844,527845,527846,527853,528005,528139,528433,528435,528516,528518,528519,528520,528713,528726,528775,528779,528965,528967,528975,528977,528990,528992,529431,529610,530333,530334,530341,530698,530733,530745,531101,531270,531880,531905,532074,532088,532095,532201,532269,532297,532497,532555,532816,532825,533046,533109,533139,533233,533242,533250,533255,533280,533329,533428,533462,533463,533464,533572,534008,534021,534047,534062,534084,534088,534089,534338,534382,534722,534736,534742,534765,534776,534799,534836,534849,534851,534907,535986,535990,535992,536020,536071,536100,536110,536160,536192,536974,536975,537144,537146,537177,537762,539130,539749,539774936,539777,539786,539800,540321,540329,540330,540368,540398,541081,541206,541231,541407,541570,541614,541630,541799,541821,541833,541835,541837,541858,541860,542039,542825,543244,5432797041,543355,543601,543805,544093,544205,544391,54479946,544943,545313156,545313706,545313924,545493,545551,545563,545883,545884,546119,546120,546188,546191,546198,546212,546219,546356,546359345,546365,546395,546512,546515,546528,546550,546772,547182,5471922188,549123,549657,550464,550806,550807,550810569,550866,550867,550894,550904,550931,550935,550997,551051,551061,551067,551127,55116628,55116633,551172,551216,551223,551224,551225,551226,551227,551228,551257,551265,551301,551318,551360,551372,551373,551417,551418,551419,551420,551441,551469,551530,551533,551570,551583,551696,551807,551821,551826,551931,551964,551991,552313,553737,553746,553747,553799,553802,553817,553848,553863,553935,553972,554313,554315,554316,556940,557119,557195,557197,557206,557229,557237,557238,557252,557255,557262,557291,557292,557553,558007,558008,558013,558052,558053,558059,558069,558092,558099,558106,558111,558123,558147,558172,558194,558201,558203,558213,558221,558227,558231,558240,558249,559006,559036,559367,559374,559375,559377,559383,559694,560058,560100156,560143,560475,560507,560568,56058946,560679,561039,562421,562694,562704,562727,562759,562783,563062,563127,563135,563146,563149,563154,563213,563256,563373,563451,563624,564327,565154,565209,566207,566265,56629000,56629001,566519,566565,56662200,56662201,566693085,566707,566745,566811,56690900,566918195,566943,567047,567059,567119,56714300,567282599,567321,56746000,567643,567698,567717,567739,568015,568259,568303,568392,568580,568691,570323,570324,570464,570791,570793,570817,570902,570957,570990,571005,571006,571039,571053,571105,571122,571162,571814,571847,571879,571898,571909,572081,572163,57220401,57253900,572612,572801,572812,572877,572915,572992,573091,573318,573412,573815,573850,573906,57403100,57403120,574752,574868,574995,575087,575101,575218,575229,575241,575299,575322,575336,575412,575470,575473,575501,575522,575603,575655,575701,57570700,575718,575742,575743,575757,575811,575822,57701301,577050,577117,577127,577194,577232,577294,577310,577364,577365,577392,57740700,57740701,577417,577424,577465,577480,577528,577594,577623,577652,577673,577723,577741,577856,577886,57788700,577894,577899,57795100,578005,578009,578012,578019,578034,578040,578062,578069400,578069600,578069602,578069604,578069701,578069702,578069991,578069994,578069996,57808200,578126,578135,578142,578144,578177,578236,579004,579006,579011,579022,579039,579076,579086,579101,579110,579112,579116,579117,579128,579148,579152,579165,579169,579172,57917588,579187,579202,579214,579259,579262,579264,57927000,579288,579302,579304,579322,579344,579369,579371,579388,579398,579412,579421,579424,579453,57948413,579495,579499,579502,579514,579528,580043,580116,580186,580245,580303,580305,580330,580365,580474,580807,580841,580849,581071,581116,581516,58157100,583158,583534,585086,585136,585360,585386,585790,585798,585876,586108,586155,586190,586422,586509,58651701,586543,586730,586807,586889,586949,586961,586968,587071,58712300,587376,587451,587512,587542,58756800,58757700,587634,587636,587721,587845,58788500,58790000,587918,588011,58804500,58810100,588133,588169,588220,588298,588332,588352,58835600,58858301,58858302,588660,588753,588839,589103,589204,589277,589432,589438,589469,589496,589502,589614,589666,589714,589715,589882,589965,589996,60110000,60110001,60110002,60110003,60110004,60110005,60110006,60110007,60110008,60110009,60110010,60110011,60110012,60110013,60110014,60110015,60110016,60110017,60110018,60110019,60110020,60110021,60110022,60110023,60110024,60110025,60110026,60110027,60110028,60110029,60110030,60110031,60110032,60110033,60110034,60110035,60110036,60110037,60110038,60110039,60110040,60110041,60110042,60110043,60110044,60110045,60110046,60110047,60110048,60110049,60110050,60110051,60110052,60110053,60110054,60110055,60110056,60110057,60110058,60110059,60110060,60110061,60110062,60110063,60110064,60110065,60110066,60110067,60110068,60110069,60110070,60110071,60110072,60110073,60110074,60110075,60110076,60110077,60110078,60110079,60110080,60110081,60110082,60110083,60110084,60110085,60110086,60110087,60110088,60110089,60110090,60110091,60110092,60110093,60110094,60110095,60110096,60110097,60110098,60110099,60110100,60110101,60110102,60110103,60110104,60110105,60110106,60110107,60110108,60110109,60110110,60110111,60110112,60110113,60110114,60110115,60110116,60110117,60110118,60110119,60112010,60112011,60112012,60112088,60112089,60112986,60112987,60112988,60112989,60113000,60113001,60113002,60113003,60113004,60113005,60113006,60113007,60113008,60113009,60113080,60113081,60113089,60113985,60114994,60119320,60119500,60119732,60119733,6011986501,6011986502,60120020,60120030,60120040,601231,601277,602081,602915,604914,627675,640509,641774,64216501,501547)


--------------------------------------Pattern 4----------------------------------------------------------------------------------

select count(distinct(hpcatm)) 
from atmtxn 
where TxnTypeID=1 
and Settlementdate >='2014-02-01 00:00:00.0' 
and Settlementdate <= '2014-03-24 24:00:00.0' 
and terminal in ('VS081015','VS080117','VS080130','VS080159','VS080291','VS080480','VS080674','VS081010','VS081876','VS082070','VS082283','VS082454','VS083307','VS080717','VS081212','VS080009','VS080043','VS080046','VS080055','VS080131','VS080140','VS080217','VS080252','VS080400','VS080654','VS080672','VS080720','VS080736','VS080746','VS080768','VS080929','VS080979','VS081001','VS081012','VS081024','VS081258','VS081265','VS081848','VS081852','VS081871','VS081875','VS081900','VS082055','VS082128','VS082256','VS082325','VS082680','VS081000','VS080114','VS080119','VS080186','VS080220','VS080224','VS080290','VS080706','VS080730','VS080973','VS081018','VS081121','VS081143','VS081179','VS082125','VS080844','VS080995','VS081005','VS081251','VS081217','VS082592','VS085874','VS081206','VS081889','VS082054','VS082282','VS082600','VS080137','VS081049','VS080301','VS080361','VS080665','VS081845','VS081888','VS080321','VS080026','VS081868','VS081199','VS086505','VS088437','VS080049','VS080471','VS088319','VS087530','VS085939','VS080496','VS080109','VS081002','VX080382','VX081531','VS085493','VS081252','VS080619','VS081031','VS083890','VX082201','VS081022','VS081009','VS080278','VS080632','VS084666','VS080242','VS081259','VS081299','VS081226','VS085464','VS081238','VS080316','VS080363','VS081264','VS081862','VS081873','VS088906','VS085382','VS084981','VS081071','VS081874','VS080025')
and bankid in (377930,377931,403019,403061,403062,411357,413433,415981,422061,423808,425850,430460,432804,432845,440687,450673,450682,450683,450686,450687,450688,450821,454088,454742,458146,476435,485621,485653,501461,502121,512457,512974,512975,512982,512991,512992,512993,514866,515590,518920,520145,522840,532254,532259,532268,532538,534061,534081,534756,541480,541481,552196,552285,552636,553906,557145,557644,557905,557907,557908,557909,557910,572545,572583,572595,572622,572668,573900,573910,574078,574085,575409,580102,586184,586837,587305,589992)

--------------------------------------Pattern 5----------------------------------------------------------------------------------
-- Run the Chase BINs on the Chase Branded Speedway ATMs for 2013

select /*+ STREAMTABLE(a) */ count(distinct(a.hpcatm))
from atmtxn a
inner join locationdetails b
on (a.atminternalid=b.atminternalid)
	where a.TxnTypeID=1
	and a.Surcharge=0
	and b.subprogram='Branding - Chase Speedway'
	and a.Settlementdate >='2013-01-01 00:00:00.0'
	and a.Settlementdate <= '2013-12-31 24:00:00.0'
	and a.bankid in (400164,400165,401135,401136,401867,402297,402298,402460,402936,402937,403075,403113,403114,403115,403116,403117,403118,403210,403211,403212,403213,403214,403215,403690,405006,405037,405038,405092,405093,405094,405095,405096,405097,405098,405357,405359,405603,405604,405607,406032,406042,406045,406047,406061,406068,406089,406091,406092,407156,407158,407166,408016,408017,408018,408161,408567,410200,410250,410413,410414,410499,411100,411201,411203,411417,411427,411431,411440,411441,411442,411443,411444,411445,411446,411450,411816,411817,411820,411821,411837,411843,411853,412129,412137,412138,412451,412452,412453,412454,412455,412456,412457,412460,412461,413590,413787,413788,414720,414740,414761,415156,418418,418435,418437,418550,418551,418552,418555,418556,418557,418558,418559,418561,418563,418564,418566,418569,418581,418582,418586,418587,420586,420730,420767,420768,420769,420770,420982,420983,421150,421151,421152,421155,421156,421157,421722,421792,422581,422587,422588,422631,422635,422636,422661,422663,422665,422666,422667,422668,422691,422693,422694,422695,422696,422697,422733,422765,424615,424617,424631,425330,425331,425448,425449,425455,425457,425463,425466,426202,426245,426246,426247,426277,426290,426295,426605,426648,426649,426650,426651,426652,426653,426681,426683,426684,426685,426686,426688,426690,426691,426693,426695,428208,429143,429161,429479,430115,430154,430324,430325,430326,430587,431000,431001,431004,431039,431051,431148,431175,431228,431231,431800,432016,432515,432516,432520,432536,432538,432542,432546,432552,432553,432562,432807,433237,433272,433721,434634,434769,434912,435787,436145,436147,436610,436611,436612,436613,436614,436615,436616,436617,436667,436881,436882,436883,436884,436885,436886,436887,436888,438422,438817,438852,438854,438857,439337,440803,440804,440882,441103,441104,441105,441597,441711,441712,441716,442707,442708,442709,442732,442742,442755,442756,442802,442807,442848,443577,443578,444399,444400,446561,446567,446568,446569,447012,447084,447201,447941,447943,447947,447948,448142,448402,448469,448517,448590,448632,448636,448666,448752,448753,448754,449737,450952,455950,455951,455952,455953,455954,455990,455996,456323,456331,456332,456333,457016,460207,461046,461090,461091,461092,461093,461094,461620,461900,461928,461983,462052,462701,462967,462968,463600,463673,464000,464016,464018,464600,467509,468005,468121,468122,469100,469200,470623,471202,471203,471563,473142,473161,473162,473622,474663,474872,475050,475054,475055,475056,475057,476767,477517,477521,477523,477788,478200,478822,478823,478824,478825,479007,479008,479024,479133,479860,480321,480412,480413,480452,480471,480472,480633,480700,482012,483312,483313,483314,483315,483316,483322,483323,483324,483325,483326,483327,483900,483910,483920,484501,484502,484503,485731,486211,486462,486509,486521,486700,486701,486732,486742,486792,486793,486794,486795,486796,487355,489797,490052,490053,490070,490071,490072,490073,490074,494154,500136,500230,501670,501671,501672,501673,501674,501675,501676,501678,501679,501680,501681,501682,501683,501684,501685,501687,501688,501690,501691,501692,501693,501694,501695,501696,501697,501698,501699,501700,501701,501702,501704,501708,501710,501711,501712,501714,501715,501716,501719,501720,501721,501724,501725,501726,502849,503147,503148,503269,505330,505331,505332,505333,505334,505335,505336,505337,505338,505339,505340,505349,505352,505360,505361,505363,505364,505365,505366,505367,505370,505371,505372,505373,505374,505377,505378,505379,507681,507682,507692,507695,507698,507700,507701,507704,507705,507706,507707,507709,507710,507713,507715,507716,507720,507721,508154,508164,508196,508197,508226,510713,510794,510935,511177,511178,511179,511180,511181,511182,511183,511373,511375,511376,511379,511383,511386,511390,511392,511393,511395,511396,511398,511400,511401,511408,511412,511419,511421,511422,511425,511594,511597,511911,511915,511916,511917,512012,512064,512065,512488,514018,514182,514183,514506,514749,514754,514755,514756,514873,514874,514909,514922,514923,514938,515403,515563,515572,515573,515574,515908,517945,517958,517966,517975,517976,518015,518016,518023,518065,518337,518338,518445,518495,518698,518748,518818,518863,519031,520470,521127,521128,521146,521147,521148,521150,521307,521843,521845,522179,522276,522277,523001,523002,523003,523434,524017,524018,524020,524026,524027,524034,524392,526021,526022,526023,526024,526025,526031,526036,526317,526327,526340,526341,526344,526345,526346,526349,526350,526398,527507,528707,528714,528715,528716,528722,528750,528751,529800,530021,530022,530023,530024,530117,530251,530252,530254,530255,530256,530258,530259,530384,530385,530785,530786,531575,531576,531721,531722,532217,532218,532220,532221,532300,532350,532351,532590,533859,533884,534326,534710,534711,534713,534716,534717,534719,536990,536991,536992,536993,536994,537167,537169,537170,537172,537175,539618,540168,540272,540501,540514,540524,540534,540539,540548,540556,540562,540568,540570,540572,540573,540575,540730,540798,540810,540811,540875,540933,540979,540980,540981,540984,540985,541011,541102,541193,541205,541284,541507,541622,541649,541657,541711,541712,541716,541728,541758,541760,541822,541825,541827,542228,542240,542241,542242,542243,542245,542270,542438,542807,543056,543143,543203,543327,543370,543505,543555,543590,543593,543748,543781,543880,544181,544376,544671,544748,544750,545060,545284,545334,545336,545337,545338,545339,545340,545341,545342,545793,546503,546504,546506,546507,546517,546598,546604,546615,546621,546626,546647,546651,546656,546657,546663,546664,546671,546672,546675,546710,546711,546725,546731,546751,547169,547221,547230,547315,547363,547364,547437,547777,547798,547891,547899,548010,548310,548311,548325,548331,548341,548376,548395,549085,549086,549087,549088,549089,549091,549092,549093,549094,549104,549144,549477,549745,549748,550273,550274,552475,552538,552847,552848,552849,552904,552905,552909,552910,553251,553433,554285,554303,554306,554307,554453,554454,554455,554456,554457,554458,554608,555152,555171,555172,556086,556106,556506,556510,556566,556590,556645,556706,556708,556717,556723,556746,556753,556760,556820,556822,556826,556896,556905,556905,556968,557557,557558,557560,557562,557564,557565,557566,558017,558019,558027,558076,558089,558090,558113,558115,558116,558250,558714,558729,558757,558767,558821,558967,558987,559023,559028,559029,559032,559033,559037,559038,559040,560766,561018,561086,561150,563111,563537,563700,566329,566330,566331,566332,566333,566334,566369,566370,566371,566372,566373,566374,566953,567223,567258,567582,568030,570240,575641,575688,575706,577765,578036,580803,586123,586132,586142,586492,586526,586616,586963,587160,587161,587162,587163,587164,587165,587166,587167,587168,587169,587170,587171,587172,587173,587174,587175,587176,587459,587618,587712,588877,588896,589122,589123,589289,589290,589291,589490,589563,600486,600875,600890,601036,601453,610098,610434,610470)
	and length(a.hpcatm) > 20

	
--------------------------------------Pattern 6----------------------------------------------------------------------------------
	
select /*+ STREAMTABLE(a) */ a.ATMInternalID
		,b.arrangement
		,count(*)
from  atmtxn a
	inner join locationdetails b
		on a.ATMInternalID = b.ATMInternalID
where a.SettlementDate >= '2013-05-01 00:00:00.0'
	and a.SettlementDate <= '2014-05-31 00:00:00.0'
	and a.TxnTypeID = '1'
	and b.arrangement in ('TURNKEY', 'CASHASSIST')
	and b.atmstatus <> 'CLOSED'
	and a.BankID in ('551873','551854','551855',.....20,000 BANKIids) group by a.ATMInternalID, b.Arrangement

--------------------------------------Pattern 7----------------------------------------------------------------------------------
-- Unq Card WDs by Month
	
select /*+ STREAMTABLE(a) */ 
	year(a.SettlementDate) as _year
	,month(a.SettlementDate) as _month
	,count(*) 
from atmtxn a 
INNER JOIN terminaldetails b 
	ON (a.atminternalid = b.atminternalid) 
where a.TxnTypeID=1 
	and a.Settlementdate >='2013-01-01 00:00:00.0' <--match start date below
	and a.Settlementdate <= '2013-12-31 24:00:00.0' <--match end date below
	and a.hpcatm in
	(
    select c.hpcatm
    from atmtxn c 
    INNER JOIN terminaldetails d ON (c.atminternalid = d.atminternalid) 
    where d.program = 'HEB - branded BBVA ' 
    and c.Settlementdate >='2013-01-01 00:00:00.0' <--3 months prior to brnading 
    and c.Settlementdate <= '2013-12-31 24:00:00.0' <-  may 31st 2014    
    and BINS= 'BBVA bins'
    and length(c.hpcatm) > 20
	)
group by month/year

--------------------------------------Pattern 8----------------------------------------------------------------------------------
-- Target WD Trans

select c.SurCat
		,sum(c.UniqPan) as UniqPan
from (select /*+ STREAMTABLE(a) */ (case when a.Surcharge > '0'
					then 'SC'
					else 'SCF' 
					end) as SurCat
				,count(distinct(a.hpcatm)) as UniqPan
		from atmtxn a 
		JOIN locationdetails b 
			ON (a.atminternalid = b.atminternalid) 
		where a.TxnTypeID=1 
		and a.Settlementdate >='2013-01-01 00:00:00.0' 
		and a.Settlementdate <= '2013-12-31 24:00:00.0' 
		and b.SubProgram = 'TARGET - CHASE'
		group by a.Surcharge) c
group by c.SurCat

